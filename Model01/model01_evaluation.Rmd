---
title: "PollQuestion#2"
classoption: openany
output:
  rmarkdown::html_vignette:
    toc: true
linkcolor: blue
urlcolor: green
vignette: >
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

<style type="text/css">

body{
font-size: 11pt;
}

h1.title {
font-size: 40pt;
}

code.r{
font-size: 11pt;
}

body {
max-width: 1600px;  
margin-left:10px;
line-height: 20px;
}

</style>

```{r global_options, echo = FALSE, include = FALSE}
knitr::opts_chunk$set(collapse = TRUE,
comment = "#>",echo = FALSE, warning = FALSE, message = FALSE,
cache = FALSE, tidy = FALSE, size = "small")
library(PFIM)
```

```{r PFIMProject, echo = FALSE, eval = TRUE, asis = TRUE}
# Create PFIM project
MyProject = PFIMProject( name = "PFIM_model_01" )
```

# Create the statistical model
```{r MyStatisticalModel, echo = FALSE, asis = TRUE}
MyStatisticalModel = StatisticalModel()
```

# constant parameters
```{r constantParameters, echo = FALSE, asis = TRUE}
Wt = 32
WtCl = 0.75
WtV = 1
```

# Model equations
```{r ModelEquations, echo = FALSE, asis = TRUE}
MyPKModel = ModelEquations( list( "RespPK1" = expression( ( dose_RespPK1 * ka/((V*(Wt/70)**(WtV)) *
                                                                                 (ka - (Cl*(Wt/70)**(WtCl))/(V*(Wt/70)**(WtV))))) *
                                                            (exp(-(Cl*(Wt/70)**(WtCl))/(V*(Wt/70)**(WtV)) *t) - exp(-ka * t ) ) ) ) )
```

# Assign the equations to the statistical model
```{r defineModelEquations, echo = FALSE, asis = TRUE}
MyStatisticalModel = defineModelEquations( MyStatisticalModel, MyPKModel)
```

# Set mu and omega for each parameter
```{r ModelParameters, echo = FALSE, asis = TRUE}

pka = ModelParameter( "ka", mu = 0.25,
                      omega = sqrt( 0.08 ),
                      distribution = LogNormalDistribution() )

pV = ModelParameter( "V", mu = 100,
                     omega = sqrt( 0.1 ),
                     distribution = LogNormalDistribution() )

pCl = ModelParameter( "Cl", mu = 10,
                      omega = sqrt( 0.2 ),
                      distribution = LogNormalDistribution() )
```

# Assign the parameters to the statistical model
```{r defineParameter, echo = FALSE, asis = TRUE}
MyStatisticalModel = defineParameter( MyStatisticalModel, pka )
MyStatisticalModel = defineParameter( MyStatisticalModel, pV )
MyStatisticalModel = defineParameter( MyStatisticalModel, pCl )
```

# Create and add the responses to the statistical model
```{r addResponse, echo = FALSE, asis = TRUE}
MyStatisticalModel = addResponse( MyStatisticalModel, Response( "RespPK1",
                                                                Combined1( sigma_inter = 1.0, sigma_slope = 0.05 ) ) )
```

# Finaly assign the statistical model to the project
```{r defineStatisticalModel, echo = FALSE, asis = TRUE}
MyProject = defineStatisticalModel( MyProject, MyStatisticalModel )
```

# Create a design
```{r Design, echo = FALSE, asis = TRUE}
design1 = Design("design1")
design2 = Design("design2")
design3 = Design("design3")
design4 = Design("design4")
```

# For each arm create and add the sampling times for each response

```{r brasTestDesign1, echo = FALSE, asis = TRUE}
brasTestDesign1 = Arm( name="Bras test", arm_size = 12 )
brasTestDesign1 = addSampling( brasTestDesign1, SamplingTimes( outcome = "RespPK1",
                                                               sample_time = c( 1, 24, 48 , 96 ) ) )
```

# ```{r brasTestDesign2, echo = FALSE, asis = TRUE}
# brasTestDesign2 = Arm( name="Bras test", arm_size = 12 )
# brasTestDesign2 = addSampling( brasTestDesign2, SamplingTimes( outcome = "RespPK1",
#                                                                sample_time = c( 4, 24, 48 ,96 ) ) )
# ```
# 
# ```{r brasTestDesign3, echo = FALSE, include = FALSE}
# brasTestDesign3 = Arm( name="Bras test", arm_size = 12 )
# brasTestDesign3 = addSampling( brasTestDesign3, SamplingTimes( outcome = "RespPK1",
#                                                                sample_time = c( 6, 24, 48 ,96 ) ) )
# ```
# 
# ```{r brasTestDesign4, echo = FALSE, asis = TRUE}
# brasTestDesign4 = Arm( name="Bras test", arm_size = 12 )
# brasTestDesign4 = addSampling( brasTestDesign4, SamplingTimes( outcome = "RespPK1",
#                                                                sample_time = c( 12, 24, 48 ,96 ) ) )
# ```

```{r, echo = FALSE, asis = TRUE}

brasTestDesign1 = addAdministration( brasTestDesign1, Administration( outcome = "RespPK1",
                                                                      time_dose = c( 0 ),
                                                                      amount_dose = c( 10000 ) ) )

brasTestDesign2 = addAdministration( brasTestDesign2, Administration( outcome = "RespPK1",
                                                                       time_dose = c( 0 ),
                                                                       amount_dose = c( 10000 ) ) )
 
brasTestDesign3 = addAdministration( brasTestDesign3, Administration( outcome = "RespPK1",
                                                                       time_dose = c( 0 ),
                                                                       amount_dose = c( 10000 ) ) )
 
brasTestDesign4 = addAdministration( brasTestDesign4, Administration( outcome = "RespPK1",
                                                                       time_dose = c( 0 ),
                                                                       amount_dose = c( 10000 ) ) )

```

```{r, echo = FALSE, asis = TRUE}
design1 = addArm( design1, brasTestDesign1 )
design2 = addArm( design2, brasTestDesign2 )
design3 = addArm( design3, brasTestDesign3 )
design4 = addArm( design4, brasTestDesign4 )

MyProject = addDesign( MyProject, design1 )
MyProject = addDesign( MyProject, design2 )
MyProject = addDesign( MyProject, design3 )
MyProject = addDesign( MyProject, design4 )
```

```{r, echo = FALSE, asis = TRUE}
evaluationPop = EvaluatePopulationFIM( MyProject ) 

show(evaluationPop)

plotSE( evaluationPop )

plotRSE( evaluationPop )
```


 


 


